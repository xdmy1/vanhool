<!DOCTYPE html>
<html>
<head>
    <title>Test Categories</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }
        
        div {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        select {
            width: 100%;
            max-width: 300px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: white;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        select:disabled {
            background-color: #f5f5f5;
            color: #666;
            cursor: not-allowed;
        }
        
        select:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }
        
        option {
            padding: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>
<body>
    <h1>Category Test</h1>
    <div>
        <label>Main Category:</label>
        <select id="main-category" onchange="loadSubs(this.value)">
            <option value="">Select Main Category</option>
        </select>
    </div>
    <div>
        <label>Subcategory:</label>
        <select id="subcategory" disabled>
            <option value="">First select main category</option>
        </select>
    </div>

    <script>
        // Initialize Supabase
        const supabase = window.supabase.createClient(
            'https://iqsfmofoezkdnmhbxwbn.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlxc2Ztb2ZvZXprZG5taGJ4d2JuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1NTA3MTksImV4cCI6MjA3OTEyNjcxOX0.w6BinbOGMZPTxyQ2e65bnSuEyHuEeQ59NQOPOtDW56I'
        );

        let allCategories = [];

        async function loadCategories() {
            try {
                const { data: categories, error } = await supabase
                    .from('categories')
                    .select('*')
                    .order('sort_order');
                
                if (error) {
                    console.error('Error:', error);
                    return;
                }

                console.log('Loaded categories:', categories);
                allCategories = categories;

                const mainCategories = categories.filter(cat => !cat.parent_id);
                const mainSelect = document.getElementById('main-category');
                
                mainSelect.innerHTML = '<option value="">Select Main Category</option>';
                mainCategories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = cat.name_en || cat.name || 'Unknown';
                    mainSelect.appendChild(option);
                });

            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        function loadSubs(parentId) {
            const subSelect = document.getElementById('subcategory');
            
            if (!parentId) {
                subSelect.disabled = true;
                subSelect.innerHTML = '<option value="">First select main category</option>';
                return;
            }

            const subcategories = allCategories.filter(cat => 
                cat.parent_id && cat.parent_id.toString() === parentId.toString()
            );

            subSelect.disabled = false;
            subSelect.innerHTML = '<option value="">Select Subcategory</option>';
            
            subcategories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.id;
                option.textContent = cat.name_en || cat.name || 'Unknown';
                subSelect.appendChild(option);
            });

            if (subcategories.length === 0) {
                subSelect.innerHTML = '<option value="">No subcategories available</option>';
                subSelect.disabled = true;
            }
        }

        // Load categories on page load
        document.addEventListener('DOMContentLoaded', loadCategories);
    </script>
</body>
</html>